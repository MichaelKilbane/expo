#!/bin/bash
# Copyright (c) Meta Platforms, Inc. and affiliates.
# Copyright 2018-present 650 Industries. All rights reserved.
#
# @generated by expo-module-scripts
#
# USAGE:
# ./with-node.sh command

CURR_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd -P)"

# Start with a default
NODE_BINARY=$(command -v node)
export NODE_BINARY

# Override the default with the global environment
ENV_PATH="$PODS_ROOT/../.xcode.env"
if [[ -f "$ENV_PATH" ]]; then
  source "$ENV_PATH"
fi

# Override the global with the local environment
LOCAL_ENV_PATH="${ENV_PATH}.local"
if [[ -f "$LOCAL_ENV_PATH" ]]; then
  source "$LOCAL_ENV_PATH"
fi

if [[ -n "$NODE_BINARY" && -x "$NODE_BINARY" ]]; then
  echo "Node found at: ${NODE_BINARY}"
else
  echo "[ERROR] You need to configure your node path in the \`.xcode.env\` file environment. " \
    "You can set it up quickly by running: " \
    'echo "export NODE_BINARY=\$(command -v node)" > .xcode.env ' \
    "in the ios folder. This is needed by React Native to work correctly. "
  exit 1
fi

# Execute argument, if present
if [[ "$#" -gt 0 ]]; then
  "$NODE_BINARY" $@
fi
